{% extends 'base/base.html'%}


{% block content %}

<div id="chart-dashboard">
    <div class="row">

    <div class="col s12 m8 l8">
        <div class="card">
                <div class="card-move-up waves-effect waves-block waves-light">
                    <div class="move-up cyan darken-1">
                        <div>
                            <span class="chart-title white-text">RIESGO POR OFICINA</span>
                            <div class="switch chart-revenue-switch right">
                                <select id="select-state" placeholder="Dime cuales sucursales quieres comparar..">
                                    <option value="">Sucursal..</option>
                                    <option value="333" >UNP UASD</option>
                                    <option value="160">Ave. Tiradentes</option>
                                    <option value="164">Dirección Gral. Tránsito Terrestre</option>
                                    <option value="165">Plaza Florida</option>
                                    <option value="166">Plaza Botánika</option>
                                    <option value="167">Lope de Vega </option>
                                    <option value="169">Plaza Haché</option>
                                    <option value="240">Torre</option>
                                    <option value="241">Plaza Central</option>
                                    <option value="261">UNP SuperMercado  Nacional 27 de Febrero</option>
                                    <option value="330">Malecon Center</option>
                                    <option value="530">Diamond Plaza</option>
                                    <option value="580">Ave. 27 de Febrero</option>
                                    <option value="610">UNP La Cancillería</option>
                                    <option value="810">Blue Mall</option>
                                    <option value="820">Agora Mall</option>
                                    <option value="830">Gazcue</option>
                                    <option value="840">Galeria 360</option>
                                    <option value="890">UNP Multicentro Jose Contreras</option>
                                    <option value="011">Independencia</option>
                                    <option value="013">Máximo Gómez</option>
                                </select>
                                <button id="button" class="btn waves-effect waves-light cyan darken-2">Filtrar</button>
                            </div>
                        </div>
                        <div class="trending-line-chart-wrapper">
                            <canvas id="trending-line-chart" height="70"></canvas>
                        </div>
                    </div>
                </div>
                <div class="card-content">
                    <a class="btn-floating btn-move-up waves-effect waves-light darken-2 right"><i class="mdi-content-add activator"></i></a>
                    <div class="col s12 m3 l3">
                        <div id="doughnut-chart-wrapper">
                            <canvas id="doughnut-chart" height="200"></canvas>
                            <div class="doughnut-chart-status">4500
                                <p class="ultra-small center-align">Sold</p>
                            </div>
                        </div>
                    </div>
                    <div class="col s12 m2 l2">
                        <ul class="doughnut-chart-legend">
                            <li class="mobile ultra-small"><span class="legend-color"></span>Mobile</li>
                            <li class="kitchen ultra-small"><span class="legend-color"></span> Kitchen</li>
                            <li class="home ultra-small"><span class="legend-color"></span> Home</li>
                        </ul>
                    </div>
                    <div class="col s12 m5 l6">
                        <div class="trending-bar-chart-wrapper">
                            <canvas id="trending-bar-chart" height="90"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card-reveal">
                    <span class="card-title grey-text text-darken-4">Revenue by Month <i class="mdi-navigation-close right"></i></span>
                    <table class="responsive-table">
                        <thead>
                            <tr>
                                <th data-field="id">ID</th>
                                <th data-field="month">Month</th>
                                <th data-field="item-sold">Item Sold</th>
                                <th data-field="item-price">Item Price</th>
                                <th data-field="total-profit">Total Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>January</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>February</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>March</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>April</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>May</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>June</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>July</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>August</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>9</td>
                                <td>Septmber</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>10</td>
                                <td>Octomber</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>11</td>
                                <td>November</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                            <tr>
                                <td>12</td>
                                <td>December</td>
                                <td>122</td>
                                <td>100</td>
                                <td>$122,00.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
    </div>
            <div class="col s12 m8 l8">
                <div class="card">
                    <div class="sample-chart-wrapper">
                        <span>Top Indicadores por Incidendias</span>
                        <canvas id="top-indicadores-incidencias" height="70"></canvas>
                      </div>
                </div>
        </div>
        <div class="col s12 m8 l4">
            <div class="card">
                <div class="sample-chart-wrapper">
                    <span>Top Indicadores por Incidendias</span>
                    <canvas id="top-indicadores-categorias" height="140"></canvas>
                  </div>
            </div>
        </div>
    </div>

</div>

<div class="row">
    <div class="col s12 m12">
        <div class="card" style="padding:2px 13px 2px 13px">
            {% include 'dashboard/map_view.html'%}
        </div>
    </div>
</div>

<script type="text/javascript" src="/static/js/modules/map_view.js"></script>

{% endblock %}



{% block scripts%}

<script>
        var trendingLineChart = document.getElementById("top-indicadores-incidencias").getContext("2d");
         new Chart(trendingLineChart, {
            type: 'bar',
            data: {
                labels : ["JAN","FEB","MAR","APR","MAY"],
                datasets: [
                    {
                        label: "Av. 27 de febrero",
                        backgroundColor: "rgba(0, 188, 212, 1)",
                        borderColor: "#46BFBD",
                        hoverBackgroundColor: "rgba(0, 188, 212, 0.7)",
                        hoverBorderColor: "rgba(70, 191, 189, 0.9)",
                        data: [6, 9, 8, 4, 6]
                    }
                ]
            },
            options: {}
        });

        var trendingLineChart = document.getElementById("top-indicadores-categorias").getContext("2d");
         new Chart(trendingLineChart, {
            type: 'bar',
            data: {
                labels : ["JAN","FEB","MAR","APR","MAY"],
                datasets: [
                    {
                        label: "Av. 27 de febrero",
                        backgroundColor: "rgba(0, 188, 212, 1)",
                        borderColor: "#46BFBD",
                        hoverBackgroundColor: "rgba(0, 188, 212, 0.7)",
                        hoverBorderColor: "rgba(70, 191, 189, 0.9)",
                        data: [6, 9, 8, 4, 6]
                    }
                ]
            },
            options: {}
        });

        var labels = ["ENE","FEB","MAR","ABR","MAY","JUN","JUL", "AGO", "SEP", "OCT", "NOV", "DIC"];
        var initialLabels = labels.slice(0,7);

        var dataSetData = [
                {
                    code : '333',
                    label: "UNP UASD",
                    backgroundColor : "rgba(128, 222, 234, 0.6)",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#ffffff",
                    pointHoverBackgroundColor : "#ffffff",
                    pointHoverBorderColor : "#ffffff",
                    data: [1, 5, 2, 4, 8, 5, 8]
                },
                {
                    code : '160',
                    label: "Ave. Tiradentes",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [20, 8, 31, 5, 20, 32, 27]
                },
                {
                    code : '164',
                    label: "Dirección Gral. Tránsito Terrestre",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [31, 48, 38, 21, 14, 42, 1]
                },
                {
                    code : '165',
                    label: "Plaza Florida",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [39, 9, 35, 47, 18, 14, 17]
                },
                {
                    code : '166',
                    label: "Plaza Botánika",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [44, 13, 4, 46, 50, 48, 1]
                },
                {
                    code : '167',
                    label: "Lope de Vega ",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [41, 45, 39, 14, 23, 47, 39]
                },
                {
                    code : '169',
                    label: "Plaza Haché",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [22, 26, 8, 47, 49, 11, 23]
                },
                {
                    code : '240',
                    label: "Torre",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [2, 2, 42, 46, 26, 1, 30]
                },
                {
                    code : '241',
                    label: "Plaza Central",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [17, 22, 37, 46, 32, 29, 15]
                },
                {
                    code : '261',
                    label: "UNP SuperMercado  Nacional 27 de Febrero",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [11, 31, 16, 26, 15, 30, 21]
                },
                {
                    code : '330',
                    label: "Malecon Center",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [1, 47, 29, 48, 23, 7, 28]
                },
                {
                    code : '530',
                    label: "Diamond Plaza",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [41, 5, 36, 16, 47, 45, 21]
                },
                {
                    code : '580',
                    label: "Ave. 27 de Febrero",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [21, 1, 10, 21, 19, 27, 48]
                },
                {
                    code : '610',
                    label: "UNP La Cancillería",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [15, 26, 36, 33, 15, 18, 37]
                },
                {
                    code : '810',
                    label: "Blue Mall",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [41, 28, 12, 10, 1, 16, 31]
                },
                {
                    code : '820',
                    label: "Agora Mall",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [34, 38, 38, 48, 35, 48, 48]
                },
                {
                    code : '830',
                    label: "Gazcue",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [2, 50, 36, 17, 28, 4, 29]
                },
                {
                    code : '840',
                    label: "Galeria 360",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [37, 48, 3, 10, 18, 33, 45]
                },
                {
                    code : '890',
                    label: "UNP Multicentro Jose Contreras",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [26, 26, 26, 30, 13, 23, 45]
                },
                {
                    code : '011',
                    label: "Independencia",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [4, 18, 45, 47, 38, 42, 42]
                },
                {
                    code : '013',
                    label: "Máximo Gómez",
                    backgroundColor : "rgba(128, 222, 234, 0.3)",
                    strokeColor : "#80deea",
                    pointRadius : 5,
                    borderColor :  "rgba(255,255,255,0.8)",
                    pointBackgroundColor : "#00bcd4",
                    pointBorderColor : "#fff",
                    pointHoverBackgroundColor : "#80deea",
                    pointHoverBorderColor : "#80deea",
                    data: [17, 38, 46, 40, 49, 17, 32]
                }];

        var initialData = dataSetData.slice(0,2);
        var selectizeInitialData = initialData.map(dataset => dataset.code);

        var ctx = document.getElementById("trending-line-chart").getContext("2d");
        chart_test = new Chart(ctx, {
            type: 'line',
            data: {labels : initialLabels, datasets : [] },
            options: {
                tooltips : {
                    backgroundColor: "rgba(255,255,255,0.8)",
                    FontSize: 12,
                    FontColor: "#000",
                    TitleFontFamily: "'Roboto','Helvetica Neue', 'Helvetica', 'Arial', sans-serif",
                    TitleFontSize: 14,
                    TitleFontStyle: "bold",
                    TitleFontColor: "#000",
                    YPadding: 8,
                    XPadding: 16,
                    CaretSize: 10,
                    CornerRadius: 6
                },
                scaleLabel : {
                    xAxes : [{
                        labels : {display : false }
                    }]
                },
                scales: {
                    yAxes: [{
                        gridLines: {
                            color: 'rgba(255,255,255,0.4)'
                        }
                    }],
                    xAxes: [{
                        gridLines: {
                            display: false
                        }
                    }]
                },
                legend: {
                    display: 'none',
                    onClick : function(e, legendItem) {
                            var index = legendItem.datasetIndex;
                            var ci = this.chart;
                            var meta = ci.getDatasetMeta(index);

                            // See controller.isDatasetVisible comment
                            meta.hidden = meta.hidden === null? !ci.data.datasets[index].hidden : null;

                            // We hid a dataset ... rerender the chart
                            ci.update();
                        },
                    labels: {
                        fontColor: 'white'
                    }
                }
            }
        });

        new Chart(document.getElementById("doughnut-chart"), {
            "type": "doughnut",
            "data": {
                "labels": ["Red", "Blue", "Yellow"],
                "datasets": [{
                    "label": "My First Dataset",
                    "data": [300, 50, 100],
                    "backgroundColor": ["rgb(255, 99, 132)", "rgb(54, 162, 235)", "rgb(255, 205, 86)"]
                }]
            },
            options : {
                legend:{ display : false}
            }
        });

        var myBarChart = new Chart(document.getElementById("trending-bar-chart"), {
            type: 'bar',
            data: {
                labels : ["JAN","FEB","MAR","APR","MAY"],
                datasets: [
                    {
                        label: "Av. 27 de febrero",
                        backgroundColor: "#46BFBD",
                        borderColor: "#46BFBD",
                        hoverBackgroundColor: "rgba(70, 191, 189, 0.4)",
                        hoverBorderColor: "rgba(70, 191, 189, 0.9)",
                        data: [6, 9, 8, 4, 6]
                    }
                ]
            },
            options: {}
        });

        // display or hide offices on risk chart
        var selectizeItemAddHandler = function (value, element) {
            var officeIndex = dataSetData.map(a => a.code).indexOf(value);
            var officeItem = dataSetData[officeIndex];

            chart_test.chart.data.datasets.push(officeItem);
            chart_test.update();
        }

        // display or hide offices on risk chart
        var selectizeItemRemoveHandler = function (value, element) {
            var officeIndex = chart_test.chart.data.datasets.map(a => a.code).indexOf(value);
            // var officeItem = chart_test.chart.data.datasets[officeIndex];
            chart_test.chart.data.datasets.splice(officeIndex, 1);
            chart_test.update();
        }

        var loadInitialSelectizeData = function () {
            for(var d in initialData) {
                chart_test.chart.data.datasets.push(dataSetData[d]);
            }

            chart_test.update();
        }

        var revenueSelectize = $('#select-state').selectize({
            maxItems: 3,
            items : selectizeInitialData,
            onItemAdd : selectizeItemAddHandler,
            onItemRemove : selectizeItemRemoveHandler
        });

        loadInitialSelectizeData();

</script>
{% endblock %}